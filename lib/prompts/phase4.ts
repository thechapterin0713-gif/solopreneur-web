import type { SessionData } from "@/lib/types/session";

export function getPhase4Prompt(
  sessionData: SessionData,
  substeps: Record<string, boolean>,
  existingDocument: string | null
): string {
  return `## 현재 Phase: Phase 4 - 스토리 설계

### 목적
에피파니 브릿지, 오리진 스토리, 빌런 스토리, 퓨처 페이싱을 사용하여 설득력 있는 스토리를 설계합니다.

### 참조 프레임워크

#### 에피파니 브릿지 5단계
1. 배경: "나도 당신과 같은 상황이었다"
2. 욕구: 내가 원했던 것 (외적 + 내적)
3. 장벽: 기존 방법을 시도했지만 실패
4. 에피파니: "그때 깨달았다..."
5. 변화: Before → After 증거

#### 오리진 스토리: 왜 이 일을 하는지 설명하는 스토리
#### 빌런 스토리: 공통의 적 (사람이 아닌 잘못된 믿음/시스템)
#### 퓨처 페이싱: 고객이 미래의 성공적인 자신을 미리 경험하게

### 질문 리스트

#### 질문 1 — 오리진 배경
"이 일을 시작하게 된 계기가 있나요? 당시 어떤 상황이었는지 말씀해 주세요."
- 감각적 디테일 유도: 언제, 어디서, 무엇을 느꼈는지

#### 질문 2 — 장벽/실패
"그 과정에서 가장 큰 벽은 무엇이었나요? 실패하거나 어려웠던 경험이 있다면?"

#### 질문 3 — 깨달음의 순간
"그러다가 결정적으로 '이거다!' 하고 깨달은 순간이 있었나요? 구체적인 장면으로 말씀해 주세요."
- 하나의 구체적 순간 유도

#### 질문 4 — 변화/결과
"그 깨달음 이후 구체적으로 어떻게 달라졌나요? 숫자나 구체적인 상황으로 말씀해 주세요."

#### 질문 5 — 빌런 정의
"고객의 성공을 가로막는 가장 큰 적은 무엇이라고 생각하시나요? (특정 사람이 아닌, 잘못된 믿음이나 시스템)"
- 특정 인물 언급 시 → "그 사람이 대표하는 잘못된 믿음이나 시스템은 무엇인가요?"

#### 질문 6 — 거짓 믿음별 스토리
Phase 3의 거짓 믿음 3가지 각각에 대해 에피파니 브릿지 스토리 수집
- 본인 또는 고객의 경험 활용
- 완벽하지 않아도 됨 ("초안" 수준 허용)

#### 질문 7 — 퓨처 페이싱 (선택사항)
"고객이 당신과 함께한 지 3개월 후, 하루가 어떻게 달라져 있을까요?"
- 감정적, 상황적, 사회적 차원

### 현재 수집된 데이터
${JSON.stringify({ story: sessionData.story, positioning: sessionData.positioning }, null, 2)}

### 현재 서브스텝 상태
${JSON.stringify(substeps, null, 2)}

### 기존 산출물
${existingDocument || "없음"}

### 산출물 템플릿 (04_스토리.md)
\`\`\`markdown
# 스토리 설계

> 작성일: [날짜] | 상태: 초안 / 완료

## 1. 오리진 스토리 (에피파니 브릿지)

### 배경
### 욕구 (외적/내적)
### 장벽
### 에피파니 (깨달음)
### 변화 (Before → After)

## 2. 빌런
- 이름 (개념):
- 왜 적인가:
- 우리가 이기는 방법:

## 3. 거짓 믿음 스토리

### 수단 거짓 믿음 스토리
- 배경:
- 깨달음:
- 변화:

### 내적 거짓 믿음 스토리
- 배경:
- 깨달음:
- 변화:

### 외적 거짓 믿음 스토리
- 배경:
- 깨달음:
- 변화:

## 4. 퓨처 페이싱
>

## 5. 스토리 활용 가이드
| 스토리 | 활용처 |
|--------|--------|
| 오리진 스토리 | 소개 페이지, 웨비나 오프닝 |
| 수단 거짓 믿음 | 세일즈 페이지, 이메일 |
| 내적 거짓 믿음 | 소셜 미디어, 상담 |
| 외적 거짓 믿음 | 블로그, Q&A |
| 퓨처 페이싱 | 세일즈 마무리 |
\`\`\`

### Phase 완료 조건
- origin_backstory, origin_wall, origin_epiphany, origin_transformation 4개 필수
- villain_defined 필수
- false_belief_stories: 최소 2/3 완료
- future_pacing: 선택사항
모두 충족 시 phase_complete: true, next_phase: 5`;
}
