import type { SessionData } from "@/lib/types/session";

export function getPhase3Prompt(
  sessionData: SessionData,
  substeps: Record<string, boolean>,
  existingDocument: string | null
): string {
  return `## 현재 Phase: Phase 3 - 포지셔닝 & 메시지

### 목적
새로운 기회, 빅 도미노, 거짓 믿음 패턴 프레임워크를 사용하여 시장에서의 차별화된 포지셔닝과 핵심 메시지를 설계합니다.

### 참조 프레임워크

#### 새로운 기회 vs 개선 (Expert Secrets)
- 개선: "기존 방법을 더 잘하라" → 저항이 큼 (비권장)
- 새로운 기회: "완전히 새로운 방법/관점" → 저항이 적음 (권장)
  - 새로운 수단(Vehicle): 완전히 다른 방법론
  - 프레임 전환: 같은 것을 다른 각도에서
  - 경험 기반: 당신만의 고유한 방법론

#### 빅 도미노
"만약 [당신의 방법]이 [꿈의 결과]를 달성하는 [유일한/최선의] 방법이라면, 다른 모든 반대가 무의미해진다"

#### 거짓 믿음 패턴
1. 수단 거짓 믿음: "이 방법이 안 통할 거야"
2. 내적 거짓 믿음: "나는 이걸 할 수 없어"
3. 외적 거짓 믿음: "내 상황에서는 안 돼"

### 질문 리스트

#### 질문 1 — 기존 대안 파악
"고객이 당신을 만나기 전에 이미 시도해본 방법이나 대안이 있나요? 최소 3가지 말씀해 주세요."

#### 질문 2 — 새로운 기회 정의
"기존 방법들과 비교했을 때, 당신의 방법은 무엇이 근본적으로 다른가요?"
- "더 잘한다"가 아닌 "근본적으로 다르다"를 유도
- 개선처럼 들리면 리프레이밍

#### 질문 3 — 빅 도미노
"만약 고객이 하나만 믿으면 나머지 모든 의심이 사라지는, 그 핵심 믿음은 무엇인가요?"
- "만약 [X]이라면, [Y]가 가능하다" 형식

#### 질문 4 — 수단 거짓 믿음
"고객이 '이 방법이 안 통할 거야'라고 생각하는 이유는 무엇일까요? 그리고 왜 그것이 틀린 생각인가요?"

#### 질문 5 — 내적 거짓 믿음
"고객이 '나는 이걸 못해'라고 생각하는 이유는? 왜 그것이 틀린 생각인가요?"

#### 질문 6 — 외적 거짓 믿음
"고객이 '내 상황에서는 안 돼'라고 생각하는 이유는? 왜 그것이 틀린 생각인가요?"

### LLM 자기검증
- 새로운 기회가 "개선"이 아닌지 확인
- 빅 도미노가 "만약 X라면, Y" 형식인지 확인
- 3가지 거짓 믿음이 서로 구분되는지 확인

### 현재 수집된 데이터
${JSON.stringify({ positioning: sessionData.positioning, offer: sessionData.offer, target_profile: sessionData.target_profile }, null, 2)}

### 현재 서브스텝 상태
${JSON.stringify(substeps, null, 2)}

### 기존 산출물
${existingDocument || "없음"}

### 산출물 템플릿 (03_포지셔닝.md)
\`\`\`markdown
# 포지셔닝 & 메시지

> 작성일: [날짜] | 상태: 초안 / 완료

## 1. 시장 분석 — 기존 대안
1.
2.
3.

## 2. 새로운 기회 정의
- 유형: 새로운 수단 / 프레임 전환 / 경험 기반
- 정의:
- 기존 방법과의 차이:

## 3. 빅 도미노
> "만약 [      ]이라면, [      ]가 가능하다"

## 4. 거짓 믿음 패턴

### 수단 거짓 믿음
- 믿음:
- 진실:
- 스토리 힌트:

### 내적 거짓 믿음
- 믿음:
- 진실:
- 스토리 힌트:

### 외적 거짓 믿음
- 믿음:
- 진실:
- 스토리 힌트:

## 5. 핵심 메시지 요약
>
\`\`\`

### Phase 완료 조건
6개 서브스텝 모두 true이면 phase_complete: true, next_phase: 4`;
}
